<!DOCTYPE html>
<html lang="ru" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ì–∞—Ä–∞–Ω—Ç-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">

  <header class="bg-white shadow-md p-4 flex justify-between items-center">
    <h1 class="text-xl font-bold text-gray-800">–ì–∞—Ä–∞–Ω—Ç - –°–æ–∑–¥–∞—Ç—å —Å–¥–µ–ª–∫—É</h1>
  </header>

  <main class="flex-grow container mx-auto p-4 max-w-md bg-white rounded-lg shadow">

    <button id="createDealBtn" class="bg-blue-600 text-white rounded-md w-full py-3 mb-5 hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition">
      –°–æ–∑–¥–∞—Ç—å —Å–¥–µ–ª–∫—É
    </button>

    <form id="dealForm" class="space-y-5 hidden">

      <!-- –í—ã–±–æ—Ä —Å—Ç—Ä–∞–Ω—ã -->
      <div>
        <label class="block mb-1 font-semibold text-gray-700">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</label>
        <select id="country" required class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-400">
          <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>
          <option value="kz">–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω</option>
          <option value="by">–ë–µ–ª–æ—Ä—É—Å—å</option>
          <option value="ru">–†–æ—Å—Å–∏—è</option>
        </select>
      </div>

      <!-- –ú–µ—Ç–æ–¥ –æ–ø–ª–∞—Ç—ã -->
      <div>
        <label class="block mb-1 font-semibold text-gray-700">–ú–µ—Ç–æ–¥ –æ–ø–ª–∞—Ç—ã</label>
        <div class="flex space-x-4">
          <button type="button" data-method="card" class="payment-method-btn px-4 py-2 border border-gray-300 rounded-md hover:bg-blue-100">–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞</button>
          <button type="button" data-method="crypto" class="payment-method-btn px-4 py-2 border border-gray-300 rounded-md hover:bg-blue-100">–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞</button>
        </div>
      </div>

      <!-- –í–∞–ª—é—Ç–∞ -->
      <div id="currencyContainer" class="hidden">
        <label class="block mb-1 font-semibold text-gray-700">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞–ª—é—Ç—É</label>
        <select id="currency" required class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-400">
          <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è JS -->
        </select>
      </div>

      <!-- –†–µ–∫–≤–∏–∑–∏—Ç—ã -->
      <div id="paymentInfoContainer" class="hidden">
        <label id="paymentInfoLabel" class="block mb-1 font-semibold text-gray-700">–í–≤–µ–¥–∏—Ç–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã</label>
        <input type="text" id="paymentInfoInput" required placeholder="" class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-400" />
      </div>

      <!-- –í—ã–±–æ—Ä –ø–æ–¥–∞—Ä–∫–∞ -->
      <div>
        <label class="block mb-1 font-semibold text-gray-700">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∞—Ä–æ–∫</label>
        <div id="giftList" class="grid grid-cols-3 gap-4">
          <!-- –ü–æ–¥–∞—Ä–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è JS -->
        </div>
      </div>

      <!-- –ü–æ–ª–∑—É–Ω–æ–∫ —Ü–µ–Ω—ã -->
      <div>
        <label for="priceRange" class="block mb-1 font-semibold text-gray-700">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ü–µ–Ω—É: <span id="priceValue">50</span></label>
        <input type="range" min="1" max="10000" step="1" value="50" id="priceRange" class="w-full" />
      </div>

      <button type="submit" class="bg-green-600 text-white rounded-md w-full py-3 hover:bg-green-700 focus:outline-none focus:ring-4 focus:ring-green-300 transition">
        –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Å–¥–µ–ª–∫—É
      </button>
    </form>

    <div id="dealCreatedMsg" class="hidden mt-6 p-4 bg-green-100 text-green-900 rounded-md select-text">
      –°–¥–µ–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞! –ï–µ ID: <span id="dealId"></span>
      <button id="copyDealIdBtn" class="ml-4 text-blue-600 hover:underline">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
    </div>

  </main>

  <footer class="bg-white shadow-inner p-4 flex justify-around text-gray-600">
    <button class="footer-tab focus:outline-none" data-tab="notifications">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</button>
    <button class="footer-tab focus:outline-none" data-tab="deals">–ê–∫—Ç–∏–≤–Ω—ã–µ —Å–¥–µ–ª–∫–∏</button>
    <button class="footer-tab focus:outline-none" data-tab="profile">–ü—Ä–æ—Ñ–∏–ª—å</button>
    <button class="footer-tab focus:outline-none" data-tab="more">–ï—â–µ</button>
  </footer>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // –ü–æ–¥–∞—Ä–∫–∏ —Å –∏–∫–æ–Ω–∫–∞–º–∏ (–ø—Ä–∏–º–µ—Ä)
    const gifts = [
      { id: 'gift1', name: '–¢–µ–ª–µ—Ñ–æ–Ω', icon: 'üì±' },
      { id: 'gift2', name: '–ù–æ—É—Ç–±—É–∫', icon: 'üíª' },
      { id: 'gift3', name: '–ü–æ–¥–∞—Ä–æ—á–Ω–∞—è –∫–∞—Ä—Ç–∞', icon: 'üéÅ' },
      { id: 'gift4', name: '–ù–∞—É—à–Ω–∏–∫–∏', icon: 'üéß' },
      { id: 'gift5', name: '–î—Ä–æ–Ω', icon: 'üöÅ' },
      { id: 'gift6', name: '–ö–Ω–∏–≥–∞', icon: 'üìö' },
    ];

    const giftListElem = document.getElementById('giftList');
    let selectedMethod = null; // card –∏–ª–∏ crypto
    let selectedGiftId = null;

    // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–∞—Ä–∫–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
    gifts.forEach(gift => {
      const div = document.createElement('div');
      div.className = 'cursor-pointer border rounded-md p-4 flex flex-col items-center justify-center hover:bg-blue-100 transition';
      div.innerHTML = `<div class="text-4xl">${gift.icon}</div><div class="mt-2">${gift.name}</div>`;

      div.addEventListener('click', () => {
        // –û—Ç–º–µ—Ç–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π
        selectedGiftId = gift.id;
        document.querySelectorAll('#giftList > div').forEach(el => el.classList.remove('border-blue-600', 'bg-blue-200'));
        div.classList.add('border-blue-600', 'bg-blue-200');
      });

      giftListElem.appendChild(div);
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤—ã–±–æ—Ä–∞ –º–µ—Ç–æ–¥–∞ –æ–ø–ª–∞—Ç—ã
    document.querySelectorAll('.payment-method-btn').forEach(button => {
      button.addEventListener('click', () => {
        selectedMethod = button.dataset.method;
        document.querySelectorAll('.payment-method-btn').forEach(btn => btn.classList.remove('bg-blue-600', 'text-white'));
        button.classList.add('bg-blue-600', 'text-white');

        const currencyContainer = document.getElementById('currencyContainer');
        const paymentInfoContainer = document.getElementById('paymentInfoContainer');
        const currencySelect = document.getElementById('currency');
        const paymentInfoInput = document.getElementById('paymentInfoInput');
        const paymentInfoLabel = document.getElementById('paymentInfoLabel');

        paymentInfoContainer.classList.remove('hidden');
        currencyContainer.classList.remove('hidden');

        // –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –æ–ø—Ü–∏–∏
        currencySelect.innerHTML = '';

        if (selectedMethod === 'card') {
          // –í–∞—Ä–∏–∞–Ω—Ç—ã –≤–∞–ª—é—Ç –¥–ª—è –∫–∞—Ä—Ç—ã
          ['–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —Ä—É–±–ª—å', '–†–æ—Å—Å–∏–π—Å–∫–∏–π —Ä—É–±–ª—å', '–¢–µ–Ω–≥–µ'].forEach(cur => {
            const opt = document.createElement('option');
            opt.value = cur;
            opt.textContent = cur;
            currencySelect.appendChild(opt);
          });
          paymentInfoLabel.textContent = '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞';
          paymentInfoInput.placeholder = '–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞';
        } else if (selectedMethod === 'crypto') {
          // –í–∞–ª—é—Ç—ã –¥–ª—è –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã
          ['TON', 'Tether', 'USDT'].forEach(cur => {
            const opt = document.createElement('option');
            opt.value = cur;
            opt.textContent = cur;
            currencySelect.appendChild(opt);
          });
          paymentInfoLabel.textContent = '–í–≤–µ–¥–∏—Ç–µ –∫—Ä–∏–ø—Ç–æ–∫–æ—à–µ–ª—ë–∫';
          paymentInfoInput.placeholder = '–ê–¥—Ä–µ—Å –∫—Ä–∏–ø—Ç–æ–∫–æ—à–µ–ª—å–∫–∞';
        }
      });
    });

    // –°–∫—Ä—ã–≤–∞—Ç—å –∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ñ–æ—Ä–º—É —Å–æ–∑–¥–∞–Ω–∏—è —Å–¥–µ–ª–∫–∏
    const createDealBtn = document.getElementById('createDealBtn');
    const dealForm = document.getElementById('dealForm');
    const dealCreatedMsg = document.getElementById('dealCreatedMsg');
    const dealIdSpan = document.getElementById('dealId');
    const copyDealIdBtn = document.getElementById('copyDealIdBtn');

    createDealBtn.addEventListener('click', () => {
      createDealBtn.classList.add('hidden');
      dealForm.classList.remove('hidden');
      dealCreatedMsg.classList.add('hidden');
    });

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ü–µ–Ω—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–∑—É–Ω–∫–∞
    const priceRange = document.getElementById('priceRange');
    const priceValue = document.getElementById('priceValue');

    priceRange.addEventListener('input', () => {
      priceValue.textContent = priceRange.value;
    });

    // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Telegram-–±–æ—Ç
    dealForm.addEventListener('submit', e => {
      e.preventDefault();

      if (!selectedMethod) {
        alert('–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Ç–æ–¥ –æ–ø–ª–∞—Ç—ã');
        return;
      }
      if (!selectedGiftId) {
        alert('–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∞—Ä–æ–∫');
        return;
      }

      const dealData = {
        country: dealForm.country.value,
        method: selectedMethod,
        currency: dealForm.currency.value,
        paymentInfo: dealForm.paymentInfoInput.value.trim(),
        giftId: selectedGiftId,
        price: priceRange.value,
      };

      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Å–¥–µ–ª–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—Ä–µ–º–µ–Ω–Ω—ã–π)
      const dealId = 'DEAL-' + Math.random().toString(36).substr(2, 9).toUpperCase();

      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram Web App
      tg.sendData(JSON.stringify({ action: 'create_deal', dealId, dealData }));

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ —Å–¥–µ–ª–∫–æ–π
      dealIdSpan.textContent = dealId;
      dealCreatedMsg.classList.remove('hidden');
      dealForm.classList.add('hidden');
    });

    // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ ID —Å–¥–µ–ª–∫–∏
    copyDealIdBtn.addEventListener('click', () => {
      navigator.clipboard.writeText(dealIdSpan.textContent).then(() => {
        alert('ID —Å–¥–µ–ª–∫–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω');
      });
    });

  </script>
</body>
</html>
